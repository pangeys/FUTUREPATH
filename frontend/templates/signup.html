<!DOCTYPE html>
<html lang="en">
<head>
    <title>Sign Up - FuturePath</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style(signup).css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/icon.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        /* Floating tooltip-style error messages */
        .error {
            color: #ffffff;
            font-size: 0.85em;
            display: none;
            font-family: Optima, sans-serif;
            font-weight: 500;
            letter-spacing: 0.3px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: errorFloat 0.3s ease-in-out;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(255, 59, 59, 0.95);
            border: 1px solid #ff6b6b;
            backdrop-filter: blur(10px);
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            margin-bottom: 8px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 59, 59, 0.4);
        }

        /* Arrow pointing down to the input */
        .error::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 20px;
            border: 6px solid transparent;
            border-top-color: rgba(255, 59, 59, 0.95);
        }

        .error.show {
            display: block;
        }

        @keyframes errorFloat {
            0% { 
                opacity: 0;
                transform: translateY(10px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Make input-box position relative for absolute positioning */
        .input-box {
            position: relative;
        }

        /* Enhanced input styling when there's an error */
        .input-box input.has-error {
            border-color: #ff3b3b !important;
            box-shadow: 0 0 15px rgba(255, 59, 59, 0.3) !important;
        }

        /* Success state for inputs */
        .input-box input.has-success {
            border-color: #4ade80 !important;
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.3) !important;
        }

        /* Custom SweetAlert Styling - Matches FuturePath Theme */
        .futurepath-popup {
            border-radius: 20px !important;
            padding: 40px !important;
            backdrop-filter: blur(13px) !important;
            border: 2px solid #ff7200 !important;
            box-shadow: 0 10px 50px #ff7200 !important;
            background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.6)) !important;
        }

        .futurepath-popup.error-popup {
            border-color: #ff3b3b !important;
            box-shadow: 0 10px 50px rgba(255, 59, 59, 0.5) !important;
        }
        
        .futurepath-title {
            font-family: Optima, sans-serif !important;
            font-size: 32px !important;
            font-weight: bold !important;
            color: #ff7200 !important;
            text-shadow: 0 0 20px rgba(255, 114, 0, 0.5);
        }

        .futurepath-title.error-title {
            color: #ff3b3b !important;
            text-shadow: 0 0 20px rgba(255, 59, 59, 0.5);
        }
        
        .futurepath-text {
            font-family: Optima, sans-serif !important;
            font-size: 18px !important;
            color: rgba(255, 255, 255, 0.95) !important;
            margin-top: 10px !important;
        }
        
        .futurepath-button {
            border-radius: 10px !important;
            padding: 15px 40px !important;
            font-family: Optima, sans-serif !important;
            font-weight: bold !important;
            font-size: 16px !important;
            text-transform: uppercase !important;
            letter-spacing: 1px !important;
            transition: all 0.3s ease !important;
            background: rgba(255, 114, 0, 0.6) !important;
            border: 1px solid #ffffff !important;
            box-shadow: 0 5px 25px rgba(255, 114, 0, 0.4) !important;
        }
        
        .futurepath-button:hover {
            background: #ff7200 !important;
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 35px #ff7200 !important;
        }

        .swal2-icon.swal2-success {
            border-color: #4ade80 !important;
        }

        .swal2-icon.swal2-success [class^='swal2-success-line'] {
            background-color: #4ade80 !important;
        }

        .swal2-icon.swal2-error {
            border-color: #ff3b3b !important;
        }

        .swal2-icon.swal2-error [class^='swal2-x-mark-line'] {
            background-color: #ff3b3b !important;
        }

        .swal2-timer-progress-bar {
            background: #ff7200 !important;
        }
    </style>
</head>
<body>

    <!-- SweetAlert CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Flask Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var isError = "{{ category }}" !== "success";
                
                Swal.fire({
                    title: "{{ 'Success!' if category == 'success' else 'Oops!' }}",
                    text: "{{ message }}",
                    icon: "{{ category }}",
                    confirmButtonText: 'OK',
                    timer: 3500,
                    timerProgressBar: true,
                    showClass: {
                        popup: 'animate__animated animate__fadeInDown animate__faster'
                    },
                    hideClass: {
                        popup: 'animate__animated animate__fadeOutUp animate__faster'
                    },
                    customClass: {
                        popup: isError ? 'futurepath-popup error-popup' : 'futurepath-popup',
                        title: isError ? 'futurepath-title error-title' : 'futurepath-title',
                        htmlContainer: 'futurepath-text',
                        confirmButton: 'futurepath-button'
                    }
                }).then(() => {
                    // Redirect to home/login page after successful signup
                    if ("{{ category }}" === "success") {
                        window.location.href = "{{ url_for('home') }}";
                    }
                });
            });
        </script>
        {% endfor %}
    {% endif %}
    {% endwith %}

    <div id="pageTransition"></div>
    <div class="main" id="page">
        <video autoplay muted loop playsinline id="bgVideo">
            <source src="{{ url_for('static', filename='images/11.mp4') }}" type="video/mp4">
        </video>

        <div class="navbar">
            <div class="icon">
                <h2 class="logo">FUTURE PATH</h2>
            </div>

            <div class="menu">
                <ul>
                    <li><a href="{{ url_for('home') }}">HOME</a></li>
                    <li><a href="{{ url_for('course') }}">COURSE</a></li>
                    <li><a href="{{ url_for('home') }}#about">ABOUT</a></li>
                    <li><a href="{{ url_for('contact') }}">CONTACT</a></li>
                </ul>
            </div>

            <div class="hamburger">
                <i class="ri-menu-line"></i>
            </div>

            <div class="sidebar" id="sidebarMenu">
                <div class="close-btn"><i class="ri-close-line"></i></div>
                <a href="{{ url_for('home') }}">HOME</a>
                <a href="{{ url_for('course') }}">COURSE</a>
                <a href="{{ url_for('home') }}#about">ABOUT</a>
                <a href="{{ url_for('contact') }}">CONTACT</a>
            </div>
        </div>

        <form method="POST" action="{{ url_for('signup') }}" id="signupForm" class="form" novalidate>
            <h2>Sign Up</h2>
            <div class="input-box">
                <input type="text" id="fullname" name="fullname" placeholder="Full Name">
                <i class="ri-user-fill"></i>
                <div class="error" id="fullNameError"></div>
            </div>
            <div class="input-box">
                <input type="email" id="email" name="email" placeholder="Email">
                <i class="ri-mail-fill"></i>
                <div class="error" id="emailError"></div>
            </div>
            <div class="input-box">
                <input type="text" id="username" name="username" placeholder="Username">
                <i class="ri-user-line"></i>
                <div class="error" id="usernameError"></div>
            </div>
            <div class="input-box">
                <input type="password" id="Password" name="password" placeholder="Password" autocomplete="off">
                <i class="ri-eye-off-fill" id="togglePassword"></i>
                <div class="error" id="passwordError"></div>
            </div>
            <div class="input-box">
                <input type="password" id="ConfirmPassword" name="ConfirmPassword" placeholder="Confirm Password" autocomplete="off">
                <i class="ri-eye-off-fill" id="toggleConfirmPassword"></i>
                <div class="error" id="confirmPasswordError"></div>
            </div>
            <button type="submit" class="bttn">Sign Up</button>
            <div class="login-link">
                Already have an account? <a href="{{ url_for('home') }}">Login</a>
            </div>
        </form>
    </div>
    
    <script src="{{ url_for('static', filename='js/toggle.js') }}"></script>
    
    <script>
    // Password toggle functionality
    const passwordInput = document.getElementById('Password');
    const togglePassword = document.getElementById('togglePassword');

    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', () => {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            togglePassword.className = isPassword ? 'ri-eye-fill' : 'ri-eye-off-fill';
        });
    }

    // Confirm password toggle functionality
    const confirmPasswordInput = document.getElementById('ConfirmPassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');

    if (toggleConfirmPassword && confirmPasswordInput) {
        toggleConfirmPassword.addEventListener('click', () => {
            const isPassword = confirmPasswordInput.type === 'password';
            confirmPasswordInput.type = isPassword ? 'text' : 'password';
            toggleConfirmPassword.className = isPassword ? 'ri-eye-fill' : 'ri-eye-off-fill';
        });
    }

    // Get all form elements
    const signupForm = document.getElementById('signupForm');
    const fullnameInput = document.getElementById('fullname');
    const emailInput = document.getElementById('email');
    const usernameInput = document.getElementById('username');
    
    // Get all error elements
    const fullNameError = document.getElementById('fullNameError');
    const emailError = document.getElementById('emailError');
    const usernameError = document.getElementById('usernameError');
    const passwordError = document.getElementById('passwordError');
    const confirmPasswordError = document.getElementById('confirmPasswordError');

    // Email validation regex
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    // Helper function to show error
    function showError(input, errorElement, message) {
        errorElement.textContent = message;
        errorElement.classList.add('show');
        input.classList.add('has-error');
        input.classList.remove('has-success');
    }

    // Helper function to show success
    function showSuccess(input, errorElement) {
        errorElement.classList.remove('show');
        input.classList.remove('has-error');
        input.classList.add('has-success');
    }

    // Helper function to clear state
    function clearState(input, errorElement) {
        errorElement.classList.remove('show');
        input.classList.remove('has-error', 'has-success');
    }

    // Full Name validation
    fullnameInput.addEventListener('blur', function() {
        if (fullnameInput.value.trim() === '') {
            showError(fullnameInput, fullNameError, 'üë§ Please enter your full name!');
        } else {
            showSuccess(fullnameInput, fullNameError);
        }
    });

    fullnameInput.addEventListener('input', function() {
        if (fullnameInput.value.trim() === '') {
            clearState(fullnameInput, fullNameError);
        } else {
            showSuccess(fullnameInput, fullNameError);
        }
    });

    // Email validation
    emailInput.addEventListener('blur', function() {
        if (emailInput.value.trim() === '') {
            showError(emailInput, emailError, 'üìß Please enter your email address!');
        } else if (!emailRegex.test(emailInput.value)) {
            showError(emailInput, emailError, '‚ö†Ô∏è Please enter a valid email address!');
        } else {
            showSuccess(emailInput, emailError);
        }
    });

    emailInput.addEventListener('input', function() {
        if (emailInput.value.trim() === '') {
            clearState(emailInput, emailError);
        } else if (!emailRegex.test(emailInput.value)) {
            showError(emailInput, emailError, '‚ö†Ô∏è Please enter a valid email address!');
        } else {
            showSuccess(emailInput, emailError);
        }
    });

    // Username validation
    usernameInput.addEventListener('blur', function() {
        if (usernameInput.value.trim() === '') {
            showError(usernameInput, usernameError, 'üë§ Please enter a username!');
        } else {
            showSuccess(usernameInput, usernameError);
        }
    });

    usernameInput.addEventListener('input', function() {
        if (usernameInput.value.trim() === '') {
            clearState(usernameInput, usernameError);
        } else {
            showSuccess(usernameInput, usernameError);
        }
    });

    // Real-time password length checking
    passwordInput.addEventListener('input', function() {
        if (passwordInput.value.length === 0) {
            clearState(passwordInput, passwordError);
        } else if (passwordInput.value.length < 8) {
            showError(passwordInput, passwordError, 'üîí Password must be at least 8 characters long!');
        } else {
            showSuccess(passwordInput, passwordError);
        }
        
        // Also check confirm password when password changes
        if (confirmPasswordInput.value.length > 0) {
            if (passwordInput.value !== confirmPasswordInput.value) {
                showError(confirmPasswordInput, confirmPasswordError, '‚ö†Ô∏è Passwords do not match!');
            } else if (passwordInput.value.length >= 8) {
                showSuccess(confirmPasswordInput, confirmPasswordError);
            }
        }
    });

    // Real-time password match checking
    confirmPasswordInput.addEventListener('input', function() {
        if (confirmPasswordInput.value.length === 0) {
            clearState(confirmPasswordInput, confirmPasswordError);
        } else if (passwordInput.value !== confirmPasswordInput.value) {
            showError(confirmPasswordInput, confirmPasswordError, '‚ö†Ô∏è Passwords do not match!');
        } else {
            showSuccess(confirmPasswordInput, confirmPasswordError);
        }
    });

    // Form submission with complete validation
    signupForm.addEventListener('submit', function(e) {
        e.preventDefault(); // Always prevent default first
        
        let hasError = false;
        let errorMessages = [];

        // Validate Full Name
        if (fullnameInput.value.trim() === '') {
            showError(fullnameInput, fullNameError, 'üë§ Please enter your full name!');
            errorMessages.push('Full Name is required');
            hasError = true;
        } else {
            showSuccess(fullnameInput, fullNameError);
        }

        // Validate Email
        if (emailInput.value.trim() === '') {
            showError(emailInput, emailError, 'üìß Please enter your email address!');
            errorMessages.push('Email is required');
            hasError = true;
        } else if (!emailRegex.test(emailInput.value)) {
            showError(emailInput, emailError, '‚ö†Ô∏è Please enter a valid email address!');
            errorMessages.push('Valid email is required');
            hasError = true;
        } else {
            showSuccess(emailInput, emailError);
        }

        // Validate Username
        if (usernameInput.value.trim() === '') {
            showError(usernameInput, usernameError, 'üë§ Please enter a username!');
            errorMessages.push('Username is required');
            hasError = true;
        } else {
            showSuccess(usernameInput, usernameError);
        }

        // Validate Password
        if (passwordInput.value.length === 0) {
            showError(passwordInput, passwordError, 'üîí Please enter a password!');
            errorMessages.push('Password is required');
            hasError = true;
        } else if (passwordInput.value.length < 8) {
            showError(passwordInput, passwordError, 'üîí Password must be at least 8 characters long!');
            errorMessages.push('Password must be at least 8 characters');
            hasError = true;
        } else {
            showSuccess(passwordInput, passwordError);
        }

        // Validate Confirm Password
        if (confirmPasswordInput.value.length === 0) {
            showError(confirmPasswordInput, confirmPasswordError, 'üîí Please confirm your password!');
            errorMessages.push('Password confirmation is required');
            hasError = true;
        } else if (passwordInput.value !== confirmPasswordInput.value) {
            showError(confirmPasswordInput, confirmPasswordError, '‚ö†Ô∏è Passwords do not match!');
            errorMessages.push('Passwords must match');
            hasError = true;
        } else if (passwordInput.value.length >= 8) {
            showSuccess(confirmPasswordInput, confirmPasswordError);
        }

        // If there are errors, show SweetAlert and prevent submission
        if (hasError) {
            Swal.fire({
                title: 'Validation Error!',
                text: 'Please fix all errors before submitting the form.',
                icon: 'error',
                confirmButtonText: 'OK',
                customClass: {
                    popup: 'futurepath-popup error-popup',
                    title: 'futurepath-title error-title',
                    htmlContainer: 'futurepath-text',
                    confirmButton: 'futurepath-button'
                }
            });
            return false;
        }

        // If no errors, submit the form
        signupForm.submit();
    });
    </script>
    
    <script>
        // Sidebar toggle
        const sidebar = document.getElementById("sidebarMenu");
        const hamburger = document.querySelector(".hamburger");
        const closeBtn = document.querySelector(".close-btn");

        hamburger.addEventListener("click", () => {
            sidebar.classList.add("active");
        });

        closeBtn.addEventListener("click", () => {
            sidebar.classList.remove("active");
        });
    </script>

    <script>
    // Page transition
    const links = document.querySelectorAll('a');
    const transition = document.getElementById('pageTransition');

    links.forEach(link => {
        const href = link.getAttribute('href');
        
        // Ignore anchor links
        if(!href || href.startsWith('#')) return;

        link.addEventListener('click', function(e) {
            e.preventDefault();
            transition.classList.add('show');

            setTimeout(() => {
                window.location.href = href;
            }, 800);
        });
    });
    </script>

</body>
</html>